<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Physik – Karteikarten</title>
<style>
  :root {
    --bg:#0b0f14; --panel:#121826; --muted:#a9b4c0; --text:#e6edf3;
    --accent:#6ea8fe; --ok:#2fbf71; --bad:#ff5c5c; --border: rgba(255,255,255,0.12);
  }
  body{ margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; background:var(--bg); color:var(--text); }
  .wrap{ max-width:1100px; margin:0 auto; padding:18px; }
  .top{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between; margin-bottom:14px; }
  .title{ font-weight:700; letter-spacing:0.2px; }
  .controls{ display:flex; flex-wrap:wrap; gap:8px; align-items:center; }
  button, input{ background:var(--panel); color:var(--text); border:1px solid var(--border); border-radius:10px; padding:10px 12px; }
  button{ cursor:pointer; }
  button:hover{ border-color: rgba(255,255,255,0.25); }
  input{ width:260px; }
  .stats{ color:var(--muted); font-size:13px; }

  .grid{ display:grid; grid-template-columns: 1fr; gap:12px; }

  .card{ background:var(--panel); border:1px solid var(--border); border-radius:16px; overflow:hidden; }
  .cardHeader{
    display:flex; justify-content:space-between; align-items:center;
    padding:10px 12px; border-bottom:1px solid var(--border); color:var(--muted); font-size:13px;
  }

  /* NEW: Split layout like your PDF: left=question, right=answer */
  .split{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap:0;
  }
  .pane{
    padding:16px; line-height:1.45; font-size:16px;
    min-height: 260px;
  }
  .pane + .pane{ border-left:1px solid var(--border); }
  .pane h2{ margin:0 0 10px 0; font-size:14px; color:var(--muted); font-weight:600; }
  .paneText{ white-space:pre-wrap; }

  .answerPlaceholder{
    color: var(--muted);
    border: 1px dashed rgba(255,255,255,0.18);
    border-radius: 12px;
    padding: 12px;
  }

  .actions{ display:flex; flex-wrap:wrap; gap:10px; padding:12px; border-top:1px solid var(--border); }
  .pill{ border-radius:999px; padding:8px 12px; border:1px solid var(--border); background:transparent; }
  .pill.primary{ background:rgba(110,168,254,0.12); border-color:rgba(110,168,254,0.35); }
  .pill.ok{ background:rgba(47,191,113,0.14); border-color:rgba(47,191,113,0.4); }
  .pill.bad{ background:rgba(255,92,92,0.14); border-color:rgba(255,92,92,0.4); }

  .footer{ margin-top:12px; color:var(--muted); font-size:13px; }
  .k{ font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size:12px; color:var(--muted); }

  @media (max-width: 900px){
    .split{ grid-template-columns: 1fr; }
    .pane + .pane{ border-left:none; border-top:1px solid var(--border); }
  }
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div>
      <div class="title">Physik – Credits an HardGxreJenni</div>
      <div class="stats" id="statsLine">…</div>
    </div>
    <div class="controls">
      <input id="search" type="text" placeholder="Suchen (Frage/Antwort)…" />
      <button id="shuffleBtn">Shuffle</button>
      <button id="resetBtn">Fortschritt zurücksetzen</button>
    </div>
  </div>

  <div class="grid">
    <div class="card" id="card">
      <div class="cardHeader">
        <div id="cardMeta">Karte</div>
        <div class="flipHint">Space: Lösung an/aus · Klick auf Karte: deaktiviert</div>
      </div>

      <!-- NEW: always show question LEFT, answer RIGHT (hidden until button) -->
      <div class="split">
        <div class="pane" id="leftPane">
          <h2>Frage</h2>
          <div class="paneText" id="questionText"></div>
        </div>
        <div class="pane" id="rightPane">
          <h2>Antwort</h2>
          <div class="paneText" id="answerText">
            <div class="answerPlaceholder">Klicke auf „Lösung anzeigen“.</div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="pill" id="prevBtn">← Zurück</button>
        <button class="pill primary" id="flipBtn">Lösung anzeigen</button>
        <button class="pill" id="nextBtn">Weiter →</button>
        <div style="flex:1"></div>
        <button class="pill ok" id="okBtn">Korrekt (K)</button>
        <button class="pill bad" id="badBtn">Falsch (F)</button>
      </div>
    </div>

    <div class="footer">
      <div><span class="k">Shortcuts:</span> <span class="k">←/→</span> Navigation, <span class="k">Space</span> Lösung an/aus, <span class="k">K</span> korrekt, <span class="k">F</span> falsch, <span class="k">S</span> Fokus Suche.</div>
      <div>Hinweis: 1 Karte = exakt 1 Frage + 1 Antwort (links/rechts im PDF). Fortschritt wird lokal im Browser gespeichert.</div>
    </div>
  </div>
</div>

<script>

let CARDS = [];

/**
 * Lädt die Markdown-Datei und wandelt sie in Karten um
 * Erwartetes Format:
 * ## X. Frage: ...
 * **Antwort:** ...
 */
async function loadMarkdownCards() {
  const res = await fetch("Physik_Formatiert.md");
  const md = await res.text();

  const blocks = md.split(/^##\s+/m).slice(1);
  let idx = 0;

  CARDS = blocks.map(block => {
    const lines = block.trim().split("\n");
    const titleLine = lines[0];

    const qMatch = titleLine.match(/^\d+\.\s*Frage:\s*(.*)$/);
    const question = qMatch ? qMatch[1].trim() : titleLine.trim();

    const answerIndex = lines.findIndex(l => l.startsWith("**Antwort:**"));
    const answer = answerIndex !== -1
      ? lines.slice(answerIndex + 1).join("\n").trim()
      : "(keine Antwort)";

    return {
      page: null,
      idx: ++idx,
      q: question,
      a: answer
    };
  });
}
const STORAGE_KEY = 'bauelemente_cards_v4_progress';




let state = {
  order: [...CARDS.keys()],
  idx: 0,
  showAnswer: false, // now means: answer shown on RIGHT or not
  filter: '',
  results: null,
  marks: {} // cardIndex -> 1 ok, -1 bad
};

function loadState(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const s = JSON.parse(raw);
    if(s && typeof s === 'object'){
      state.marks = s.marks || {};
    }
  }catch(e){}
}

function saveState(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify({marks: state.marks}));
}

function normalize(t){
  return (t||'').toLowerCase().replace(/\s+/g,' ').trim();
}

function getActiveOrder(){
  return state.results ? state.results : state.order;
}

function clampIndex(){
  const o = getActiveOrder();
  if(o.length === 0){ state.idx = 0; return; }
  if(state.idx < 0) state.idx = 0;
  if(state.idx >= o.length) state.idx = o.length - 1;
}

function render(){
  const stats = document.getElementById('statsLine');
  const meta = document.getElementById('cardMeta');

  const questionText = document.getElementById('questionText');
  const answerText = document.getElementById('answerText');
  const flipBtn = document.getElementById('flipBtn');

  const o = getActiveOrder();
  const total = o.length;

  const marks = state.marks || {};
  let ok=0, bad=0;
  for(const v of Object.values(marks)){
    if(v===1) ok++;
    if(v===-1) bad++;
  }

  if(total === 0){
    meta.textContent = 'Keine Treffer';
    questionText.textContent = 'Keine Karte passt zur Suche.';
    answerText.innerHTML = '<div class="answerPlaceholder">—</div>';
    stats.textContent = `Treffer: 0 | Gesamt: ${CARDS.length} | Korrekt: ${ok} | Falsch: ${bad}`;
    return;
  }

  clampIndex();
  const cardIndex = o[state.idx];
  const card = CARDS[cardIndex];

  meta.textContent = `Karte ${state.idx+1}/${total} (PDF Seite ${card.page})`;

  // LEFT is ALWAYS question (one per card)
  questionText.textContent = card.q;

  // RIGHT is answer only if toggled on
  if(state.showAnswer){
    // Use textContent to keep it safe and preserve line breaks
    answerText.textContent = card.a;
    flipBtn.textContent = 'Lösung ausblenden';
  } else {
    answerText.innerHTML = '<div class="answerPlaceholder">Klicke auf „Lösung anzeigen“.</div>';
    flipBtn.textContent = 'Lösung anzeigen';
  }

  const m = marks[String(cardIndex)];
  let markTxt = '—';
  if(m===1) markTxt = 'Korrekt';
  if(m===-1) markTxt = 'Falsch';

  stats.textContent = `Gesamt: ${CARDS.length} | Aktive Liste: ${total} | Bewertet: ${ok+bad} (Korrekt: ${ok}, Falsch: ${bad}) | Aktuelle Karte: ${markTxt}`;
}

function toggleAnswer(){
  state.showAnswer = !state.showAnswer;
  render();
}

function next(){
  state.showAnswer = false;   // hide answer on navigation
  state.idx++;
  render();
}

function prev(){
  state.showAnswer = false;   // hide answer on navigation
  state.idx--;
  render();
}

function shuffle(){
  const arr = [...CARDS.keys()];
  for(let i=arr.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [arr[i],arr[j]]=[arr[j],arr[i]];
  }
  state.order = arr;
  state.idx = 0;
  state.showAnswer = false;
  render();
}

function applySearch(q){
  const needle = normalize(q);
  state.filter = q;
  if(!needle){
    state.results = null;
    state.idx = 0;
    state.showAnswer = false;
    render();
    return;
  }
  const res=[];
  for(let i=0;i<CARDS.length;i++){
    const c=CARDS[i];
    const hay = normalize(c.q + ' ' + c.a);
    if(hay.includes(needle)) res.push(i);
  }
  state.results = res;
  state.idx = 0;
  state.showAnswer = false;
  render();
}

function mark(val){
  const o = getActiveOrder();
  if(o.length===0) return;
  const cardIndex = o[state.idx];
  state.marks[String(cardIndex)] = val;
  saveState();
  state.showAnswer = false;
  render();
}

function resetProgress(){
  if(!confirm('Fortschritt wirklich löschen?')) return;
  state.marks = {};
  saveState();
  render();
}

// wire
document.getElementById('flipBtn').addEventListener('click', (e)=>{ e.stopPropagation(); toggleAnswer(); });
document.getElementById('nextBtn').addEventListener('click', (e)=>{ e.stopPropagation(); next(); });
document.getElementById('prevBtn').addEventListener('click', (e)=>{ e.stopPropagation(); prev(); });
document.getElementById('shuffleBtn').addEventListener('click', shuffle);
document.getElementById('okBtn').addEventListener('click', (e)=>{ e.stopPropagation(); mark(1); });
document.getElementById('badBtn').addEventListener('click', (e)=>{ e.stopPropagation(); mark(-1); });
document.getElementById('resetBtn').addEventListener('click', resetProgress);

const search = document.getElementById('search');
search.addEventListener('input', (e)=>applySearch(e.target.value));

// IMPORTANT CHANGE:
// You asked for "only when clicking Lösung anzeigen" -> so we DISABLE card click flipping.
// (You can re-enable by calling toggleAnswer() here if you ever want it.)
// const cardEl = document.getElementById('card'); // not used for flip anymore

window.addEventListener('keydown', (e)=>{
  if(e.key==='ArrowRight') { e.preventDefault(); next(); }
  else if(e.key==='ArrowLeft') { e.preventDefault(); prev(); }
  else if(e.key===' ') { e.preventDefault(); toggleAnswer(); }
  else if(e.key==='k' || e.key==='K') { e.preventDefault(); mark(1); }
  else if(e.key==='f' || e.key==='F') { e.preventDefault(); mark(-1); }
  else if(e.key==='s' || e.key==='S') { e.preventDefault(); search.focus(); }
});

(async () => {
  await loadMarkdownCards();
  state.order = [...CARDS.keys()];
  loadState();
  render();
})();
</script>
</body>
</html>
